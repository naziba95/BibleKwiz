import{x as A,V as E,r as l,z as k,C as N,W as O,c as o,a as e,t as c,X as L,F as P,p as R,G as y,B as U,o as a,D as V}from"./fNgEoHnC.js";import{u as G}from"./CttbmQ9R.js";import{u as H}from"./BfqfkKoQ.js";const J=window.setInterval,W={class:"min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4"},X={key:0,class:"text-center"},Y={key:1,class:"text-center"},K={class:"text-xl font-semibold text-red-500"},Z={key:2,class:"bg-white rounded-lg shadow-lg w-full max-w-md overflow-hidden"},ee={class:"p-4 space-y-4"},te={class:"flex justify-between items-center"},se={class:"text-blue-500 font-semibold"},le={class:"w-full bg-gray-200 rounded-full h-2.5"},oe={class:"flex justify-center items-center"},ae={class:"relative w-20 h-20"},ne={class:"w-20 h-20 transform -rotate-90"},re=["stroke-dashoffset"],ue={class:"absolute inset-0 flex items-center justify-center text-2xl font-bold"},ie={key:0,class:"text-center"},ce={class:"text-xl"},de={key:1},ve={class:"bg-blue-100 rounded-lg p-4"},fe={class:"text-xl font-semibold text-center"},he={class:"space-y-2 mt-4"},be=["onClick"],ge=["disabled"],me={key:3,class:"text-center"},Q=30,ze={__name:"quizPage",setup(ye){const _=U().public.apiBaseUrl;console.log(_);const I=G(),x=H(),z=A();E();const n=l(null),d=l(0),v=l(null),u=l(!1),g=l(!1),m=l(0),p=l(!0),f=l(null),h=l(30),q=l(null),S=k(()=>x.user&&x.user.id?x.user.id:"user123"),b=k(()=>n.value?n.value.questionIds.length:0),i=k(()=>!n.value||!n.value.questionIds?null:n.value.questionIds[d.value]);N(async()=>{await j(),n.value&&C()}),O(()=>{w()});async function j(){const r=I.selectedDay;if(!r){f.value="No day specified for the quiz.",p.value=!1;return}try{const t=await(await fetch(`${_}/quiz/active/byday?day=${r}`)).json();if(Array.isArray(t)&&t.length>0)n.value=t[0];else throw new Error("Failed to fetch quiz data")}catch(s){console.error("Error fetching quiz data:",s),f.value="Failed to load quiz. Please try again later.",z.push("/home")}finally{p.value=!1}}function B(r){!u.value&&i.value&&(v.value=r,u.value=!0,w(),r===i.value.correctOption&&(m.value+=1))}function D(){d.value<b.value-1?(d.value++,F()):M()}function F(){v.value=null,u.value=!1,h.value=Q,C()}async function M(){g.value=!0;const r=Math.round(m.value/b.value*100);m.value=r;const s={quizId:n.value._id,score:r};try{if(!(await fetch(`${_}/quiz/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,userId:S.value})})).ok)throw new Error("Failed to submit quiz results");console.log("Quiz results submitted successfully")}catch(t){console.error("Error submitting quiz results:",t),f.value="Failed to submit quiz results. Please try again later."}}function C(){q.value=J(()=>{h.value>0?h.value-=.1:(w(),u.value=!0)},100)}function w(){clearInterval(q.value)}function T(){console.log("Closing quiz")}function $(){z.push("/home")}return(r,s)=>(a(),o("div",W,[p.value?(a(),o("div",X,s[0]||(s[0]=[e("p",{class:"text-xl font-semibold"},"Loading quiz...",-1)]))):f.value?(a(),o("div",Y,[e("p",K,c(f.value),1)])):n.value?(a(),o("div",Z,[e("div",ee,[e("div",te,[e("button",{onClick:T,class:"text-gray-500 hover:text-gray-700"},s[1]||(s[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",se,c(d.value+1)+"/"+c(b.value),1)]),e("div",le,[e("div",{class:"bg-blue-500 h-2.5 rounded-full",style:L({width:`${(d.value+1)/b.value*100}%`})},null,4)]),e("div",oe,[e("div",ae,[(a(),o("svg",ne,[s[2]||(s[2]=e("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor","stroke-width":"8",fill:"transparent",class:"text-gray-200"},null,-1)),e("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor","stroke-width":"8",fill:"transparent","stroke-dasharray":226.19,"stroke-dashoffset":226.19*(1-h.value/Q),class:"text-blue-500"},null,8,re)])),e("span",ue,c(Math.ceil(h.value)),1)])]),g.value?(a(),o("div",ie,[s[3]||(s[3]=e("h2",{class:"text-2xl font-bold mb-4"},"Quiz Completed!",-1)),e("p",ce,"Your score: "+c(m.value)+"%",1),e("button",{onClick:$,class:"mt-4 px-4 py-2 bg-blue-500 text-white font-semibold rounded hover:bg-blue-600 transition-colors"}," Go to Home ")])):i.value?(a(),o("div",de,[e("div",ve,[e("h2",fe,c(i.value.question),1)]),e("div",he,[(a(),o(P,null,R(["A","B","C","D"],t=>e("button",{key:t,onClick:xe=>B(t),class:V(["w-full p-4 rounded-lg text-left transition-colors",{"bg-gray-100 hover:bg-gray-200":v.value===null,"bg-blue-500 text-white":v.value===t&&!u.value,"bg-green-500 text-white":u.value&&t===i.value.correctOption,"bg-red-500 text-white":u.value&&v.value===t&&t!==i.value.correctOption}])},c(i.value[`option${t}`]),11,be)),64))])])):y("",!0)]),!g.value&&i.value?(a(),o("button",{key:0,onClick:D,disabled:!u.value,class:"w-full p-4 bg-blue-500 text-white font-semibold hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"},c(d.value===b.value-1?"Finish":"Next"),9,ge)):y("",!0)])):y("",!0),g.value?(a(),o("div",me)):y("",!0)]))}};export{ze as default};
